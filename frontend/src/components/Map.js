import axios from "axios";
import React, { useEffect, useState } from "react";
import { MapContainer, TileLayer, Marker, Popup, Polyline, Rectangle } from 'react-leaflet';
import '../styles/Map.css';
import Powerline from "./Powerline";

function Map()
{   
    const polyline = [[[38.54664607633386, -121.73498483802013],
    [38.54671122185596, -121.73500331913878]],
   [[38.54671122185596, -121.73500331913878],
    [38.546920425709516, -121.7350626686529]],
   [[38.54752852917191, -121.7352351802669],
    [38.547926850139305, -121.73534818728028],
    [38.548209809346574, -121.73542846328407]],
   [[38.569858275589944, -121.74615015619743],
    [38.56982081400311, -121.74617199129595]],
   [[38.566764866707594, -121.74519981386861],
    [38.56680497743272, -121.74521178436451]],
   [[38.54949604105854, -121.73582853302862],
    [38.549957218518564, -121.7357155742814]],
   [[38.548209809346574, -121.73542846328407],
    [38.54831059894257, -121.73485001496869],
    [38.54835115514488, -121.73485923251886]],
   [[38.54835115514488, -121.73485923251886],
    [38.54839133429368, -121.73487082204352]],
   [[38.56054790533494, -121.73562628870508],
    [38.56051365682543, -121.73633590760632]],
   [[38.578506457725844, -121.75167906568146],
    [38.57850996414759, -121.75247268935463]],
   [[38.559940696867095, -121.73556764575818],
    [38.56050697293532, -121.73557115362411],
    [38.56054790533494, -121.73562628870508]],
   [[38.5610062090819, -121.73602564647862],
    [38.561288826284645, -121.73601441440678],
    [38.5621114426789, -121.73600442837419],
    [38.56294118397984, -121.73598669939035],
    [38.56326270267709, -121.73598705038138]],
   [[38.56051365682543, -121.73633590760632],
    [38.56049397927595, -121.73688305422314]],
   [[38.56049397927595, -121.73688305422314],
    [38.56048737574018, -121.7370666536599],
    [38.56048350581577, -121.73747698603533],
    [38.56047652741263, -121.7381759853235],
    [38.56045951852292, -121.73817570967601]],
   [[38.55703671861995, -121.73553078285381],
    [38.55744735870467, -121.73555567452581],
    [38.557488521622574, -121.73555780981393]],
   [[38.5593947483645, -121.73318974111096],
    [38.55961578336949, -121.73318666253971],
    [38.559656946272355, -121.73318625420401]],
   [[38.5593947483645, -121.73318974111096],
    [38.55937627932917, -121.73318999808019],
    [38.55910900073229, -121.73311061869315],
    [38.558848400248465, -121.73312116289048]],
   [[38.55703671861995, -121.73553078285381],
    [38.55701630464855, -121.7355295454313],
    [38.556731954374186, -121.73543303687211],
    [38.555985445651125, -121.73551384868313]],
   [[38.55699481268393, -121.73484867046825],
    [38.55699159950097, -121.73479636419195],
    [38.556988558618684, -121.73457599420125]],
   [[38.55212302330311, -121.73550410349225],
    [38.5520312165812, -121.73555153948803]],
   [[38.55856235858573, -121.73319831842151],
    [38.55856518474059, -121.73353745412415]],
   [[38.55775399012258, -121.73284357654691],
    [38.557753483396375, -121.73315160294419]],
   [[38.557753483396375, -121.73315160294419],
    [38.55775012838064, -121.73352450192931]],
   [[38.55775399012258, -121.73284357654691],
    [38.55778328972454, -121.73253425191986]],
   [[38.556988558618684, -121.73457599420125],
    [38.55698303305899, -121.73408941861382]],
   [[38.55856518474059, -121.73353745412415],
    [38.558566980108374, -121.73374670913056]],
   [[38.55775012838064, -121.73352450192931],
    [38.557747849254724, -121.73390206124728]],
   [[38.549966247213426, -121.7355256362949],
    [38.55054160785808, -121.73556827383952]],
   [[38.549957218518564, -121.7357155742814],
    [38.549959884552145, -121.7357679258698]],
   [[38.548209809346574, -121.73542846328407],
    [38.54845920311379, -121.73549906199186]],
   [[38.54845920311379, -121.73549906199186],
    [38.54949604105854, -121.73582853302862]],
   [[38.549957218518564, -121.7357155742814],
    [38.549966247213426, -121.7355256362949]],
   [[38.55845141420953, -121.73216142095735],
    [38.55812976099367, -121.73218629136652],
    [38.557808883158806, -121.73220879717259],
    [38.55778328972454, -121.73253425191986]],
   [[38.55845141420953, -121.73216142095735],
    [38.55874061676218, -121.73213900166205],
    [38.559029332859225, -121.73211662016604]],
   [[38.56072256306095, -121.73600900075131],
    [38.5610062090819, -121.73602564647862]],
   [[38.55856235858573, -121.73319831842151],
    [38.55788301922004, -121.73316006459353],
    [38.557753483396375, -121.73315160294419]],
   [[38.551361448386565, -121.73512478197964],
    [38.55119122969961, -121.73512746308731],
    [38.55107419416588, -121.73512820586375],
    [38.550713060522156, -121.73513486549272]],
   [[38.55865788723383, -121.73556405216232],
    [38.55794442713809, -121.73558057505629]],
   [[38.55794442713809, -121.73558057505629],
    [38.55791696675757, -121.7355812107703],
    [38.55762122058078, -121.73556454410179],
    [38.557529685718265, -121.73555989896568]],
   [[38.559940696867095, -121.73556764575818],
    [38.559264803942185, -121.73555752873693],
    [38.55865788723383, -121.73556405216232]],
   [[38.560470795095156, -121.73896606945804],
    [38.56047026738216, -121.73901703548022],
    [38.560473941490585, -121.73909582155567]],
   [[38.560473941490585, -121.73909582155567],
    [38.56047759186751, -121.73917410586537]],
   [[38.560473941490585, -121.73909582155567],
    [38.560515136534825, -121.739096354841]],
   [[38.55054160785808, -121.73556827383952],
    [38.551147111794855, -121.73560142192203],
    [38.551238875673114, -121.73560203972708]],
   [[38.57060861833468, -121.74639261001262],
    [38.57138064133336, -121.746598362921]],
   [[38.55211922181185, -121.73511285535199],
    [38.55194084570904, -121.73511582447398],
    [38.551483710259696, -121.7351228556026],
    [38.551361448386565, -121.73512478197964]],
   [[38.56072256306095, -121.73600900075131],
    [38.56068140972555, -121.73600658592775],
    [38.56051365682543, -121.73633590760632]],
   [[38.556966534302624, -121.73263756064185],
    [38.5571565100694, -121.73268695094849],
    [38.557548518627435, -121.73279227679829],
    [38.55775399012258, -121.73284357654691]],
   [[38.55696207361126, -121.7322453227772],
    [38.556966534302624, -121.73263756064185]],
   [[38.55697403208714, -121.73329718232957],
    [38.556977500462516, -121.73355282686474],
    [38.556978807769624, -121.73371742117152],
    [38.55698303305899, -121.73408941861382]],
   [[38.556966534302624, -121.73263756064185],
    [38.55697168682437, -121.73309078571884],
    [38.55697403208714, -121.73329718232957]],
   [[38.55529714157535, -121.73556883551079],
    [38.554925671754674, -121.73564315142217],
    [38.55458779206935, -121.73564605328544],
    [38.553901552294334, -121.73567154646759]],
   [[38.559656946272355, -121.73318625420401],
    [38.559698141689914, -121.7331858450829]],
   [[38.56040174054562, -121.7381811803561],
    [38.560401740545736, -121.73818118034869]],
   [[38.560401740545736, -121.73818118034869],
    [38.56040185531578, -121.73817417610931],
    [38.56045951852292, -121.73817570967601]],
   [[38.57421207907696, -121.74735199319056],
    [38.574202791825016, -121.74740312167425]],
   [[38.574202791825016, -121.74740312167425],
    [38.57419322854307, -121.74745416609915]],
   [[38.56120987164682, -121.74340903826928],
    [38.56121004481117, -121.74346150665181]],
   [[38.566775523306234, -121.74525688842498],
    [38.56671535771559, -121.74523893157853],
    [38.56672475597205, -121.74518784253144]],
   [[38.56196028561926, -121.74359899597883],
    [38.56120969879419, -121.74335656988184]],
   [[38.56278272258801, -121.74386463355367],
    [38.56196028561926, -121.74359899597883]],
   [[38.56366976388821, -121.74415114424394],
    [38.56278272258801, -121.74386463355367]],
   [[38.557529685718265, -121.73555989896568],
    [38.557488521622574, -121.73555780981393]],
   [[38.56046008236288, -121.73812324585555],
    [38.56046702483004, -121.73747708201473],
    [38.56046843177483, -121.73708439250801]],
   [[38.566764866707594, -121.74519981386861],
    [38.56672475597205, -121.74518784253144]],
   [[38.57669672867857, -121.75824272499497],
    [38.57542564653058, -121.75828799465701],
    [38.57413499137812, -121.7583121881103],
    [38.57271507068589, -121.75833880586762]],
   [[38.5714209651101, -121.74660910948002],
    [38.57139969559627, -121.74665405127679]],
   [[38.57139969559627, -121.74665405127679],
    [38.57137846049338, -121.74669892048342]],
   [[38.5714209651101, -121.74660910948002],
    [38.57296881935724, -121.74702119381162]],
   [[38.57359096298261, -121.74718683222846],
    [38.57357937533489, -121.74723719151456]],
   [[38.573558521823536, -121.74733871944812],
    [38.57354867969047, -121.74738967814557]],
   [[38.57421207907696, -121.74735199319056],
    [38.57486062641755, -121.74753268155973],
    [38.574900871158896, -121.74754390073569]],
   [[38.57589138208019, -121.74805294905674],
    [38.57635335225804, -121.74819407217785],
    [38.57682257599263, -121.74833866179132],
    [38.577219229904074, -121.74846092706815],
    [38.57851284059334, -121.74885868612984]],
   [[38.57538811049265, -121.74769183767158],
    [38.57540477710736, -121.7472355200004]],
   [[38.57138064133336, -121.746598362921],
    [38.5714209651101, -121.74660910948002]],
   [[38.56657259679018, -121.7450887969923],
    [38.56652000056842, -121.74507180772218]],
   [[38.56051365682543, -121.73633590760632],
    [38.56043379281574, -121.73707975053904]],
   [[38.56451995209124, -121.7444257582622],
    [38.56366976388821, -121.74415114424394]],
   [[38.56045951852292, -121.73817570967601],
    [38.56046008236288, -121.73812324585555]],
   [[38.56047759186751, -121.73917410586537],
    [38.56047852703574, -121.73919421701133],
    [38.56047947683902, -121.73922312667146],
    [38.56048021982915, -121.739245754897],
    [38.56048083468077, -121.73926447161855],
    [38.56049235449088, -121.73961516748999]],
   [[38.56040084484175, -121.73823581541075],
    [38.56040001985316, -121.73828609521304]],
   [[38.56040001985316, -121.73828609521304],
    [38.56040001985304, -121.73828609522042]],
   [[38.560494400098364, -121.73967744228106],
    [38.56050716588084, -121.74068653101239]],
   [[38.559029332859225, -121.73211662016604],
    [38.55930784195072, -121.73209502929677],
    [38.55959578974892, -121.73214974291105],
    [38.55988215123735, -121.73221097263125]],
   [[38.552613732126915, -121.73559477533607],
    [38.553073340225815, -121.7356827052943],
    [38.55335188119584, -121.73568456727072],
    [38.553901552294334, -121.73567154646759]],
   [[38.56047129490215, -121.73891360461585],
    [38.560470795095156, -121.73896606945804]],
   [[38.56033398045087, -121.74201298461404],
    [38.56033469320999, -121.74198975175423],
    [38.56036512381546, -121.74146097894446],
    [38.56050716588084, -121.74068653101239]],
   [[38.556988558618684, -121.73457599420125],
    [38.55679647169523, -121.73453124922999],
    [38.55638788799978, -121.73444848187782]],
   [[38.569858275589944, -121.74615015619743],
    [38.57060861833468, -121.74639261001262]],
   [[38.574900871158896, -121.74754390073569],
    [38.57538811049265, -121.74769183767158]],
   [[38.57296881935724, -121.74702119381162],
    [38.57359096298261, -121.74718683222846]],
   [[38.57359096298261, -121.74718683222846],
    [38.57421207907696, -121.74735199319056]],
   [[38.55212302330311, -121.73550410349225],
    [38.55211922181185, -121.73511285535199]],
   [[38.56069921289427, -121.75799063777711],
    [38.56074013732216, -121.75798461318156]],
   [[38.55703671861995, -121.73553078285381],
    [38.55699481268393, -121.73484867046825]],
   [[38.56673356567479, -121.74514079480998],
    [38.56672475597205, -121.74518784253144]],
   [[38.578506457725844, -121.75167906568146],
    [38.5782264303441, -121.75167700929549]],
   [[38.583406245621944, -121.74609312206059],
    [38.58294296695058, -121.74735496312123],
    [38.582484742376124, -121.74860785804027],
    [38.58235138545374, -121.74899379867904],
    [38.58103032585609, -121.74857163330513],
    [38.58023820899155, -121.7483516974232]],
   [[38.57851284059334, -121.74885868612984],
    [38.57850846465864, -121.74963012416514],
    [38.5785016537293, -121.75057468881501],
    [38.578506457725844, -121.75167906568146]],
   [[38.57851284059334, -121.74885868612984],
    [38.57879208880447, -121.74791143654828],
    [38.57915675415552, -121.74801798888636],
    [38.58023820899155, -121.7483516974232]],
   [[38.5782264303441, -121.75167700929549],
    [38.57790553447812, -121.75167810078051]],
   [[38.56101708348058, -121.7432947481369],
    [38.56096447286189, -121.74369903262206]],
   [[38.55529714157535, -121.73556883551079],
    [38.555985445651125, -121.73551384868313]],
   [[38.5593947483645, -121.73318974111096],
    [38.5593970929796, -121.73346289505331]],
   [[38.56632704956901, -121.74500947934213],
    [38.56652000056842, -121.74507180772218]],
   [[38.56673356567479, -121.74514079480998],
    [38.56657259679018, -121.7450887969923]],
   [[38.55196250273584, -121.73558704363855],
    [38.5520312165812, -121.73555153948803]],
   [[38.56120969879419, -121.74335656988184],
    [38.56120987164682, -121.74340903826928]],
   [[38.560515136534825, -121.739096354841],
    [38.5605563011021, -121.73909426134514]],
   [[38.56045951852292, -121.73817570967601],
    [38.56047129490215, -121.73891360461585]],
   [[38.56046843177483, -121.73708439250801],
    [38.56049397927595, -121.73688305422314]],
   [[38.56049397927595, -121.73688305422314],
    [38.56055595626493, -121.73639460540403]],
   [[38.56033398045087, -121.74201298461404],
    [38.560274853776235, -121.7419999449543]],
   [[38.560274853776235, -121.7419999449543],
    [38.56023429318607, -121.74199076183712]],
   [[38.57357937533489, -121.74723719151456],
    [38.57356836392958, -121.74728776031031]],
   [[38.552613732126915, -121.73559477533607],
    [38.55277578923456, -121.73507744221293]],
   [[38.55196250273584, -121.73558704363855],
    [38.552613732126915, -121.73559477533607]],
   [[38.551238875673114, -121.73560203972708],
    [38.55196250273584, -121.73558704363855]],
   [[38.57850996414759, -121.75247268935463],
    [38.5785069497405, -121.75315708414644]],
   [[38.5785069497405, -121.75315708414644],
    [38.57850549591314, -121.75348678947492],
    [38.57850090430943, -121.75448961949658]],
   [[38.54619768796649, -121.73483340554023],
    [38.54621713498928, -121.73486315361734],
    [38.54664607633386, -121.73498483802013]],
   [[38.546920425709516, -121.7350626686529],
    [38.54752852917191, -121.7352351802669]],
   [[38.546920425709516, -121.7350626686529],
    [38.54700026460937, -121.73460630299374]],
   [[38.56050716588084, -121.74068653101239],
    [38.5604452994415, -121.74072348431375]],
   [[38.5604452994415, -121.74072348431375],
    [38.560407926744396, -121.74074556130557]],
   [[38.56033398045087, -121.74201298461404],
    [38.56032425621613, -121.7423256585707],
    [38.560336645918696, -121.74310113988024]],
   [[38.55856235858573, -121.73319831842151],
    [38.558848400248465, -121.73312116289048]],
   [[38.57538811049265, -121.74769183767158],
    [38.57538246973239, -121.74790181684304],
    [38.57589138208019, -121.74805294905674]],
   [[38.57357937533489, -121.74723719151456],
    [38.573539677374406, -121.74722316456591],
    [38.57352850409699, -121.74727447590006]],
   [[38.57352850409699, -121.74727447590006],
    [38.57351851793803, -121.74732618217766],
    [38.573558521823536, -121.74733871944812]],
   [[38.56101708348058, -121.7432947481369],
    [38.56120969879419, -121.74335656988184]],
   [[38.57356836392958, -121.74728776031031],
    [38.573558521823536, -121.74733871944812]],
   [[38.56982081400311, -121.74617199129595],
    [38.56978335257918, -121.74619382636845]],
   [[38.57797584732924, -121.7581914185533],
    [38.57828230436434, -121.7581831853137],
    [38.57828652892934, -121.75817975164266]],
   [[38.57828652892934, -121.75817975164266],
    [38.57850387102651, -121.75800309816775],
    [38.57850327227522, -121.75646750777473],
    [38.57850492436055, -121.75550564851858]],
   [[38.56615943086317, -121.74495533496244],
    [38.56533832660035, -121.74469010283467]],
   [[38.56533832660035, -121.74469010283467],
    [38.56451995209124, -121.7444257582622]],
   [[38.569021820010306, -121.74587998629502],
    [38.569858275589944, -121.74615015619743]],
   [[38.56095719328058, -121.74327544384931],
    [38.56099712575942, -121.74328834259508]],
   [[38.568127236935304, -121.74559099733953],
    [38.569021820010306, -121.74587998629502]],
   [[38.56673356567479, -121.74514079480998],
    [38.568127236935304, -121.74559099733953]],
   [[38.56615943086317, -121.74495533496244],
    [38.56632704956901, -121.74500947934213]],
   [[38.56634103219566, -121.74493925423657],
    [38.56632704956901, -121.74500947934213]],
   [[38.56634103219566, -121.74493925423657],
    [38.56635115933045, -121.74488839146794]],
   [[38.56099712575942, -121.74328834259508],
    [38.56101708348058, -121.7432947481369]],
   [[38.56049235449088, -121.73961516748999],
    [38.560494400098364, -121.73967744228106]],
   [[38.56039876067778, -121.73708052679076],
    [38.560352960650114, -121.73708154167433]],
   [[38.560359669565095, -121.73823391235582],
    [38.560360552180015, -121.73818008486279],
    [38.560401740545736, -121.73818118034869]],
   [[38.560401740545736, -121.73818118034869],
    [38.56040174071323, -121.73818118035314]],
   [[38.56040001985304, -121.73828609522042],
    [38.56039979064027, -121.73830007317495]],
   [[38.56040084484175, -121.73823581541075],
    [38.56040174054562, -121.7381811803561]],
   [[38.560400020020666, -121.73828609521749],
    [38.56040001985316, -121.73828609521304]],
   [[38.56040001985316, -121.73828609521304],
    [38.56035883216016, -121.73828499986894],
    [38.560359669565095, -121.73823391235582]],
   [[38.56043379281574, -121.73707975053904],
    [38.560398760342544, -121.73708052679663]],
   [[38.57850090430943, -121.75448961949658],
    [38.57850492436055, -121.75550564851858]],
   [[38.57669672867857, -121.75824272499497],
    [38.57749098005838, -121.75821290071401],
    [38.57797584732924, -121.7581914185533]],
   [[38.57797584732924, -121.7581914185533],
    [38.57828652892934, -121.75817975164266]],
   [[38.57828652892934, -121.75817975164266],
    [38.57928834187509, -121.75814212999649],
    [38.579343730622064, -121.76265508623443]]]

    const [lines, setLines] = useState([]);

    useEffect(() => {
        axios.get('http://localhost:8000/powerlines/')
            .then((res) => {
                let data = res.data.results[0];
                console.log(data);
                let lineObject = {};
                lineObject['wear'] = data.wear;
                lineObject['weather'] = data.weather;
                lineObject['vegetation'] = data.vegetation;
                lineObject['name'] = data.name;
                let newCoords = [];
                for (let i=0; i<data.geometry.coordinates.length; i++)
                {
                    let tmp = [];
                    for (let j=0; j<data.geometry.coordinates[i].length; j++)
                    {
                        tmp.push((data.geometry.coordinates[i][j]).reverse());
                    }
                    newCoords.push(tmp);
                }
                lineObject['coordinates'] = newCoords;
                setLines([...lines, lineObject]);
                // console.log(lineObject);
            })
            .catch(err => console.log(err));
    }, []);

    const doThis = (e) =>
    {
        console.log(lines);
    }

    const redOptions = { color : 'purple' };
    const greenOptions = { color : 'green' };
    const rectangle = [
        [38.546501023184646, -121.76321817174035],
        [38.58325086112612, -121.73167409436275]
    ]
    return (
        <div>
            <MapContainer center={[35.606914, -118.249178]} zoom={7} scrollWheelZoom={true}>
                <TileLayer
                    attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                />
                {/* <Marker position={[35.606914, -118.249178]}>
                    <Popup>
                    A pretty CSS3 popup. <br /> Easily customizable.
                    </Popup>
                </Marker> */}
                {lines.map(powerline => {
                    return <Powerline name={powerline.name} wear={powerline.wear} weather={powerline.weather} vegetation={powerline.vegetation} coordinates={powerline.coordinates} threshold={0.5}></Powerline>
                })}
                {/* <Polyline pathOptions={redOptions} positions={polyline}><Popup>Lillian Brown Line</Popup></Polyline> */}
                {/* <Rectangle bounds={rectangle} pathOptions={greenOptions}/> */}
            </MapContainer>
            put input here later
            <button onClick={doThis}>click me</button>
        </div>
    ); 
}

export default Map;